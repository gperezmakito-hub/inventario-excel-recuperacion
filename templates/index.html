<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario Tintas - MKTO CATAL IMPORTACIONES</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üì¶ Inventario de Tintas</h1>
            <p class="subtitle">MKTO CATAL IMPORTACIONES, S.L</p>
        </header>

        <!-- Estad√≠sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Productos</div>
                <div class="stat-value" id="total-productos">0</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-label">Productos Bajo Stock</div>
                <div class="stat-value" id="productos-bajos">0</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">Valor Total Inventario</div>
                <div class="stat-value" id="valor-total">‚Ç¨0.00</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="productos">Productos</button>
            <button class="tab" data-tab="movimientos">Movimientos</button>
        </div>

        <!-- Tab: Productos -->
        <div id="productos-tab" class="tab-content content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Listado de Productos</h2>
                <button class="btn btn-primary" onclick="app.openModal('modal-nuevo-producto')">
                    ‚ûï Nuevo Producto
                </button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>C√≥digo</th>
                        <th>Nombre</th>
                        <th>Categor√≠a</th>
                        <th>Stock Actual</th>
                        <th>Stock M√≠nimo</th>
                        <th>Precio</th>
                        <th>Ubicaci√≥n</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="productos-tbody">
                    <tr>
                        <td colspan="8" class="loading">Cargando productos...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab: Movimientos -->
        <div id="movimientos-tab" class="tab-content content" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>√öltimos Movimientos</h2>
                <button class="btn btn-primary" onclick="app.openModal('modal-nuevo-movimiento')">
                    üìù Registrar Movimiento
                </button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Producto</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th>Motivo</th>
                        <th>Usuario</th>
                    </tr>
                </thead>
                <tbody id="movimientos-tbody">
                    <tr>
                        <td colspan="6" class="loading">Cargando movimientos...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal: Nuevo Producto -->
    <div id="modal-nuevo-producto" class="modal">
        <div class="modal-content">
            <h2>Nuevo Producto</h2>
            <form id="form-nuevo-producto" onsubmit="event.preventDefault(); handleNuevoProducto();">
                <div class="form-group">
                    <label>C√≥digo *</label>
                    <input type="text" name="codigo" required>
                </div>
                <div class="form-group">
                    <label>Nombre *</label>
                    <input type="text" name="nombre" required>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <input type="text" name="categoria" value="tintas">
                </div>
                <div class="form-group">
                    <label>Stock Actual *</label>
                    <input type="number" step="0.01" name="stock_actual" required>
                </div>
                <div class="form-group">
                    <label>Stock M√≠nimo *</label>
                    <input type="number" step="0.01" name="stock_minimo" required>
                </div>
                <div class="form-group">
                    <label>Precio Unitario *</label>
                    <input type="number" step="0.01" name="precio_unitario" required>
                </div>
                <div class="form-group">
                    <label>Unidad</label>
                    <input type="text" name="unidad" value="unidad">
                </div>
                <div class="form-group">
                    <label>Ubicaci√≥n</label>
                    <input type="text" name="ubicacion">
                </div>
                <div class="form-group">
                    <label>Observaciones</label>
                    <textarea name="observaciones" rows="3"></textarea>
                </div>
                <div class="actions">
                    <button type="submit" class="btn btn-success">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="app.closeModal('modal-nuevo-producto')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Nuevo Movimiento -->
    <div id="modal-nuevo-movimiento" class="modal">
        <div class="modal-content">
            <h2>Registrar Movimiento</h2>
            <form id="form-nuevo-movimiento" onsubmit="event.preventDefault(); handleNuevoMovimiento();">
                <div class="form-group">
                    <label>Producto *</label>
                    <select name="producto_id" id="select-producto" required>
                        <option value="">Seleccione un producto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tipo *</label>
                    <select name="tipo" required>
                        <option value="">Seleccione tipo</option>
                        <option value="entrada">Entrada</option>
                        <option value="salida">Salida</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad *</label>
                    <input type="number" step="0.01" name="cantidad" required>
                </div>
                <div class="form-group">
                    <label>Motivo</label>
                    <input type="text" name="motivo">
                </div>
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" name="usuario" value="Admin">
                </div>
                <div class="actions">
                    <button type="submit" class="btn btn-success">Registrar</button>
                    <button type="button" class="btn btn-danger" onclick="app.closeModal('modal-nuevo-movimiento')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        function handleNuevoProducto() {
            const form = document.getElementById('form-nuevo-producto');
            const formData = new FormData(form);
            const data = {
                codigo: formData.get('codigo'),
                nombre: formData.get('nombre'),
                categoria: formData.get('categoria'),
                stock_actual: parseFloat(formData.get('stock_actual')),
                stock_minimo: parseFloat(formData.get('stock_minimo')),
                precio_unitario: parseFloat(formData.get('precio_unitario')),
                unidad: formData.get('unidad'),
                ubicacion: formData.get('ubicacion'),
                observaciones: formData.get('observaciones'),
                activo: true
            };
            app.addProducto(data);
            form.reset();
        }

        function handleNuevoMovimiento() {
            const form = document.getElementById('form-nuevo-movimiento');
            const formData = new FormData(form);
            const data = {
                producto_id: parseInt(formData.get('producto_id')),
                tipo: formData.get('tipo'),
                cantidad: parseFloat(formData.get('cantidad')),
                motivo: formData.get('motivo'),
                usuario: formData.get('usuario')
            };
            app.addMovimiento(data);
            form.reset();
        }

        // Cargar productos en el selector cuando se abra el modal
        document.querySelector('[onclick*="modal-nuevo-movimiento"]').addEventListener('click', () => {
            const select = document.getElementById('select-producto');
            select.innerHTML = '<option value="">Seleccione un producto</option>' +
                window.app.productos.map(p => 
                    `<option value="${p.id}">${p.codigo} - ${p.nombre}</option>`
                ).join('');
        });
    </script>
</body>
</html>
